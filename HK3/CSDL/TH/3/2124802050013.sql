CREATE DATABASE QLBH
GO
USE QLBH
GO

CREATE TABLE KHACHHANG
(
	MAKH CHAR(4) PRIMARY KEY NOT NULL,
	HOTEN VARCHAR(40) NOT NULL,
	DCHI VARCHAR(50) NOT NULL,
	SODT VARCHAR(20) NOT NULL,
	NGSINH SMALLDATETIME NOT NULL,
	NGDK SMALLDATETIME NOT NULL,
	DOANHSO MONEY NOT NULL,
)

ALTER TABLE HOADON ADD
	CONSTRAINT FK_MAKH FOREIGN KEY (MAKH)
	REFERENCES KHACHHANG (MAKH)

ALTER TABLE HOADON ADD
	CONSTRAINT FK_MANV FOREIGN KEY (MANV)
	REFERENCES NHANVIEN (MANV)

ALTER TABLE CTHD ADD
	CONSTRAINT FK_MASP FOREIGN KEY (MASP)
	REFERENCES SANPHAM (MASP)

ALTER TABLE CTHD ADD
	CONSTRAINT FK_SOHD FOREIGN KEY (SOHD)
	REFERENCES HOADON (SOHD)

CREATE TABLE NHANVIEN
(
	MANV CHAR(4) PRIMARY KEY NOT NULL,
	HOTEN VARCHAR(40) NOT NULL,
	SODT VARCHAR(20) NOT NULL,
	NGVL SMALLDATETIME NOT NULL,
)


CREATE TABLE SANPHAM
(
	MASP CHAR(4) PRIMARY KEY NOT NULL,
	TENSP VARCHAR(40) NOT NULL,
	DVT VARCHAR(40) NOT NULL,
	NUOCSX VARCHAR(40) NOT NULL,
	GIA MONEY NOT NULL,
)

CREATE TABLE HOADON
(
	SOHD INT PRIMARY KEY NOT NULL,
	NGHD DATETIME NOT NULL,
	MAKH CHAR(4) NOT NULL,
	MANV CHAR(4) NOT NULL,
	TRIGIA MONEY NOT NULL,
)


CREATE TABLE CTHD
(
	MASP CHAR(4) REFERENCES SANPHAM (MASP),
	SOHD INT NOT NULL,
	SL INT NOT NULL,
	PRIMARY KEY(MASP, SOHD)
)


INSERT INTO NHANVIEN(MANV, HOTEN, SODT, NGVL) VALUES
('NV01', 'NGUYEN NHU NHUT', 0927345678, 4/13/2010),
('NV02', 'LE THI PHI YEN', 0987567390, 4/21/2010),
('NV03', 'NGUYEN VAN B', 0997047382, 6/27/2010),
('NV04', 'NGO THANH TUAN', 0913758498, 6/24/2010),
('NV05', 'NGUYEN THI TRUC THANH', 0918590387, 7/20/2010)

SELECT *
FROM NHANVIEN

INSERT INTO KHACHHANG(MAKH, HOTEN, DCHI, SODT, NGSINH, DOANHSO, NGDK) VALUES
('KH01', 'NGUYEN VAN A', '731 TRAN HUNG DAO, Q5, TPHCM', 08823451, 10/22/1960, 13060000, 07/22/2010),
('KH02', 'TRAN NGOC HAN', '23/5 NGUYEN TRAI, Q5, TPHCM', 0908256478, 4/3/1974, 280000, 07/30/2010),
('KH03', 'TRAN NGOC LINH', '45 NGUYEN CANH CHAN, Q1, TPHCM', 0938776266, 6/12/1980, 3860000, 08/05/2010),
('KH04', 'TRAN MINH LONG', '50/34 LE DAI HANH, Q10, TPHCM', 0917325476, 3/9/1965,250000, 02/10/2010),
('KH05', 'LE NHAT MINH', '34 TRUONG DINH, Q3, TPHCM', 08246108, 3/10/1950, 21000, 10/28/2010),
('KH06', 'LE HOAI THUONG', '227 NGUYEN VAN CU, Q5, TPHCM', 08631738, 12/31/1981, 951000, 11/24/2010),
('KH07', 'NGUYEN VAN TAM', '32/3 TRAN BINH TRONG, Q5, TPHCM', 0916783565, 4/6/1971, 951000, 11/24/2010),
('KH08', 'PHAN THI THANH', '45/2 AN DUONG VUONG, Q5, TPHCM', 0938435756, 1/10/1971, 365000, 12/13/2010),
('KH09', 'LE HA VINH', '873 LE HONG PHONG, Q5, TPHCM', 08654763, 9/3/1979, 70000, 01/14/2011),
('KH10', 'HA DUY LAP', '34/34B NGUYEN TRAI, Q1, TPHCM', 08768904, 5/2/1983, 67500, 01/16/2011)


SELECT *
FROM KHACHHANG

INSERT INTO SANPHAM(MASP, TENSP, DVT, NUOCSX, GIA) VALUES
('BC01', 'BUT CHI', 'CAY', 'SINGAPORE', 3000),
('BC02', 'BUT CHI', 'CAY', 'SINGAPORE', 5000),
('BC03', 'BUT CHI', 'CAY', 'VIET NAM', 3500),
('BC04', 'BUT CHI', 'HOP', 'VIET NAM', 30000),
('BB01', 'BUT BI', 'CAY', 'VIET NAM', 5000),
('BB02', 'BUT BI', 'CAY', 'TRUNG QUOC', 7000),
('BB03', 'BUT BI', 'HOP', 'THAI LAN', 10000),
('TV01', 'TAP 100 GIAY MONG', 'QUYEN', 'TRUNG QUOC', 2500),
('TV02', 'TAP 200 GIAY MONG', 'QUYEN', 'TRUNG QUOC',4500),
('TV03', 'TAP 100 GIAY TOT', 'QUYEN', 'VIET NAM', 3000),
('TV04', 'TAP 200 GIAY TOT', 'QUYEN', 'VIET NAM', 5500),
('TV05', 'TAP 100 TRANG', 'CHUC', 'VIET NAM', 23000),
('TV06', 'TAP 200 TRANG', 'CHUC', 'VIET NAM', 53000),
('TV07', 'TAP 100 TRANG', 'CHUC', 'TRUNG QUOC', 34000),
('ST01', 'SO TAY 500 TRANG', 'QUYEN', 'TRUNG QUOC', 40000),
('ST02', 'SO TAY LOAI 1', 'QUYEN', 'VIET NAM', 55000),
('ST03', 'SO TAY LOAI 2', 'QUYEN', 'VIET NAM', 51000),
('ST04', 'SO TAY', 'QUYEN', 'THAI LAN', 55000),
('ST05', 'SO TAY MONG', 'QUYEN', 'THAI LAN', 20000),
('ST06', 'PHAN VIET BANG', 'HOP', 'VIET NAM', 5000),
('ST07', 'PHAN KHONG BUI', 'HOP', 'VIET NAM', 7000),
('ST08', 'BONG BANG', 'CAI', 'VIET NAM', 1000),
('ST09', 'BUT LONG', 'CAY', 'VIET NAM', 5000),
('ST10', 'BUT LONG', 'CAY', 'TRUNG QUOC', 7000)

SELECT *
FROM SANPHAM


INSERT INTO HOADON(SOHD, NGHD, MAKH, MANV, TRIGIA) VALUES
(1001, 07/23/2010, 'KH01', 'NV01', 320000),
(1002, 08/12/2010, 'KH01', 'NV02', 840000),
(1003, 08/23/2010, 'KH02', 'NV01', 100000),
(1004, 09/01/2010, 'KH02', 'NV01', 180000),
(1005, 10/20/2010, 'KH01', 'NV02', 3800000),
(1006, 10/16/2010, 'KH01', 'NV03', 2430000),
(1007, 10/28/2010, 'KH03', 'NV03', 510000),
(1008, 10/28/2010, 'KH01', 'NV03', 440000),
(1009, 10/28/2010, 'KH03', 'NV04', 200000),
(1010, 11/01/2010, 'KH01', 'NV01', 5200000),
(1011, 11/04/2010, 'KH04', 'NV03', 250000),
(1012, 11/30/2010, 'KH05', 'NV03', 21000),
(1013, 12/12/2010, 'KH06', 'NV01', 5000),
(1014, 31/12/2010, 'KH03', 'NV02', 3150000),
(1015, 01/01/2011, 'KH06', 'NV01', 910000),
(1016, 01/01/2011, 'KH07', 'NVO2', 12500),
(1017, 01/02/2011, 'KH08', 'NV03', 35000),
(1018, 01/13/2011, 'KH08', 'NV03', 330000),
(1019, 01/13/2011, 'KH01', 'NV03', 30000),
(1020, 01/14/2011, 'KH09', 'NV04', 70000),
(1021, 01/16/2011, 'KH10', 'NV03', 67500),
(1022, 01/16/2011, '', 'NV03', 7000),
(1023, 01/17/2011, '', 'NV01', 330000)

SELECT *
FROM HOADON

INSERT INTO CTHD(SOHD, MASP, SL) VALUES
(1010, 'TV02', 10),
(1010, 'ST08', 100),
(1010, 'ST04', 50),
(1010, 'ST03', 100),
(1011, 'ST06', 50),
(1012, 'ST07', 3),
(1013, 'ST08', 5),
(1014, 'BC02', 80),
(1014, 'BB02', 100),
(1014, 'BC04', 60),
(1015, 'BB02', 30),
(1015, 'BB03', 7),
(1016, 'TV01', 5),
(1017, 'TV02', 1),
(1017, 'TV03', 1),
(1017, 'TV04', 5),
(1018, 'ST04', 6),
(1019, 'ST05', 1),
(1019, 'ST06', 2),
(1020, 'ST07', 10),
(1021, 'ST08', 5),
(1021, 'TV01', 7),
(1021, 'TV02', 10),
(1022, 'ST07', 1),
(1023, 'ST04', 6)

SELECT *
FROM CTHD	


--CAU 1
SELECT MASP,TENSP
FROM  SANPHAM
WHERE NUOCSX='TRUNG QUOC'

--CAU 2
SELECT MASP,TENSP
FROM  SANPHAM
WHERE DVT='CAY' OR DVT='QUYEN'

--CAU 3
SELECT MASP,TENSP
FROM  SANPHAM
WHERE MASP LIKE 'B%01'


--CAU 4
SELECT MASP,TENSP
FROM  SANPHAM
WHERE NUOCSX='TRUNG QUOC' AND GIA BETWEEN 30000 AND 40000

--CAU 5
SELECT MASP,TENSP
FROM  SANPHAM
WHERE (NUOCSX='TRUNG QUOC' OR NUOCSX='THAI LAN') AND GIA BETWEEN 30000 AND 40000

--CAU 6
SELECT SOHD,TRIGIA
FROM  HOADON
WHERE NGHD='1/1/2007' OR NGHD='2/1/2007'


--CAU 7
SELECT SOHD,TRIGIA
FROM  HOADON
WHERE MONTH(NGHD)=1 AND YEAR(NGHD)=2007
ORDER BY  NGHD ASC,TRIGIA DESC

--CAU 8
SELECT A.MAKH,HOTEN
FROM  HOADON A, KHACHHANG B
WHERE A.MAKH=B.MAKH AND NGHD='1/1/2007'

--CAU 9
SELECT SOHD,TRIGIA
FROM  HOADON A, NHANVIEN B
WHERE A.MANV=B.MANV AND NGHD='28/10/2006' AND HOTEN='NGUYEN VAN B' 

--CAU 10
SELECT C.MASP, TENSP
FROM  HOADON A, KHACHHANG B, CTHD C, SANPHAM D
WHERE A.MAKH=B.MAKH AND A.SOHD=C.SOHD AND C.MASP=D.MASP AND
  MONTH(NGHD)=10 AND YEAR(NGHD)=2006 AND HOTEN='NGUYEN VAN A' 


--CAU 11
SELECT SOHD
FROM  CTHD
WHERE MASP='BB01'OR MASP='BB02'


--CAU 12
SELECT SOHD
FROM  CTHD
WHERE MASP='BB01'OR MASP='BB02'


--CAU 13
SELECT SOHD
FROM  CTHD
WHERE SL BETWEEN 10 AND 20 AND MASP='BB01'
  AND SOHD IN (  SELECT SOHD
     FROM  CTHD
     WHERE MASP='BB02')


--CAU 14
SELECT DISTINCT A.MASP,TENSP
FROM  SANPHAM A, HOADON B, CTHD C
WHERE NUOCSX='TRUNG QUOC' OR
  (B.SOHD=C.SOHD AND C.MASP=A.MASP AND NGHD='1/1/2007') 


--CAU 15
SELECT MASP, TENSP
FROM  SANPHAM
WHERE MASP NOT IN ( SELECT MASP
     FROM  CTHD)



--CAU 16
SELECT MASP, TENSP
FROM  SANPHAM
WHERE MASP NOT IN ( SELECT A.MASP
     FROM  CTHD A, HOADON B
     WHERE A.SOHD=B.SOHD AND YEAR(NGHD)=2006)


--CAU 17
SELECT MASP, TENSP
FROM  SANPHAM
WHERE NUOCSX='TRUNG QUOC' AND
  MASP NOT IN ( SELECT A.MASP
     FROM  CTHD A, HOADON B
     WHERE A.SOHD=B.SOHD AND YEAR(NGHD)=2006)